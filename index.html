<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>MARGA2HIGH</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0 }
    body {
      font-family: Inter, sans-serif;
      background: #000;
      color: #fff;
      line-height: 1.5;
    }

    a { color: inherit; text-decoration: none }
    button { cursor: pointer; border: none }

    .container {
      max-width: 1200px;
      margin: auto;
      padding: 0 24px;
    }

    /* HEADER */
    header {
      position: sticky;
      top: 0;
      background: rgba(0,0,0,.95);
      border-bottom: 1px solid #111;
      z-index: 50;
    }
    .header-inner {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 18px 0;
    }
    .logo {
      font-weight: 800;
      font-size: 20px;
      letter-spacing: 1px;
      cursor: pointer;
    }
    .nav {
      display: flex;
      gap: 24px;
      align-items: center;
    }
    .btn {
      padding: 10px 16px;
      border-radius: 8px;
      font-weight: 600;
      transition: .2s;
    }
    .btn-red {
      background: #dc2626;
      color: #fff;
    }
    .btn-red:hover {
      background: #b91c1c;
    }
    .btn-dark {
      background: #111;
      color: #fff;
    }
    .btn-dark:hover {
      background: #1a1a1a;
    }
    .btn-cyan {
      background: #06b6d4;
      color: #fff;
    }
    .btn-cyan:hover {
      background: #0891b2;
    }

    /* CART ICON */
    .cart-icon {
      position: relative;
      cursor: pointer;
      padding: 8px;
    }
    .cart-badge {
      position: absolute;
      top: 2px;
      right: 2px;
      background: #dc2626;
      color: #fff;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 700;
    }

    .user-menu {
      position: relative;
    }
    .user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: #dc2626;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      cursor: pointer;
    }
    .user-dropdown {
      position: absolute;
      top: 50px;
      right: 0;
      background: #111;
      border: 1px solid #1a1a1a;
      border-radius: 12px;
      padding: 8px;
      min-width: 180px;
      display: none;
    }
    .user-dropdown.active {
      display: block;
    }
    .user-dropdown-item {
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: .2s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .user-dropdown-item:hover {
      background: #1a1a1a;
    }

    /* SEARCH BAR */
    .search-bar {
      background: #111;
      border: 1px solid #1a1a1a;
      border-radius: 8px;
      padding: 10px 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      max-width: 300px;
    }
    .search-bar input {
      background: transparent;
      border: none;
      color: #fff;
      outline: none;
      width: 100%;
      font-size: 14px;
    }
    .search-bar input::placeholder {
      color: #666;
    }

    /* HERO */
    .hero {
      padding: 90px 0;
      background: linear-gradient(to bottom, #111, #000);
    }
    .hero h1 {
      font-size: 56px;
      font-weight: 800;
      margin-bottom: 16px;
    }
    .hero p {
      color: #aaa;
      max-width: 600px;
      margin-bottom: 28px;
    }

    /* FEATURES */
    .features {
      display: grid;
      grid-template-columns: repeat(4,1fr);
      gap: 16px;
      padding: 60px 0;
    }
    .feature {
      background: #0d0d0d;
      border: 1px solid #1a1a1a;
      border-radius: 14px;
      padding: 20px;
    }
    .feature h3 {
      font-size: 14px;
      margin-bottom: 6px;
    }
    .feature p {
      font-size: 12px;
      color: #777;
    }

    /* PRODUCTS */
    .products {
      padding: 70px 0;
    }
    .products-grid {
      display: grid;
      grid-template-columns: repeat(3,1fr);
      gap: 24px;
    }
    .product {
      background: #0c0c0c;
      border: 1px solid #1a1a1a;
      border-radius: 18px;
      overflow: hidden;
      transition: .2s;
      cursor: pointer;
    }
    .product:hover {
      transform: translateY(-4px);
      border-color: #dc2626;
    }
    .product img {
      width: 100%;
      height: 180px;
      object-fit: cover;
      opacity: .8;
    }
    .product-body {
      padding: 18px;
    }
    .product h4 {
      font-size: 16px;
      margin-bottom: 8px;
    }
    .price {
      color: #dc2626;
      font-weight: 800;
      font-size: 20px;
    }

    /* MODAL */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,.9);
      z-index: 100;
      overflow-y: auto;
      padding: 40px 20px;
    }
    .modal.active {
      display: block;
    }
    .modal-content {
      max-width: 1200px;
      margin: auto;
      background: #0a0a0a;
      border: 1px solid #1a1a1a;
      border-radius: 20px;
      overflow: hidden;
    }
    .modal-close {
      position: absolute;
      top: 20px;
      right: 20px;
      background: #111;
      color: #fff;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      cursor: pointer;
      z-index: 101;
    }

    /* AUTH MODAL */
    .auth-modal-content {
      max-width: 450px;
      margin: 100px auto;
      background: #0a0a0a;
      border: 1px solid #1a1a1a;
      border-radius: 20px;
      padding: 40px;
    }
    .auth-title {
      font-size: 28px;
      font-weight: 800;
      margin-bottom: 8px;
      text-align: center;
    }
    .auth-subtitle {
      text-align: center;
      color: #777;
      margin-bottom: 32px;
    }
    .form-group {
      margin-bottom: 20px;
    }
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
      color: #aaa;
    }
    .form-input {
      width: 100%;
      background: #111;
      border: 1px solid #1a1a1a;
      color: #fff;
      padding: 12px 16px;
      border-radius: 8px;
      outline: none;
      font-size: 14px;
    }
    .form-input:focus {
      border-color: #06b6d4;
    }
    .form-btn {
      width: 100%;
      padding: 14px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 16px;
      margin-top: 8px;
    }
    .auth-switch {
      text-align: center;
      margin-top: 20px;
      color: #777;
      font-size: 14px;
    }
    .auth-switch a {
      color: #06b6d4;
      cursor: pointer;
    }
    .auth-switch a:hover {
      text-decoration: underline;
    }

    /* DASHBOARD */
    .dashboard {
      padding: 80px 0;
      min-height: 80vh;
    }
    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 40px;
    }
    .dashboard-title {
      font-size: 32px;
      font-weight: 800;
    }
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 24px;
    }
    .order-card {
      background: #0c0c0c;
      border: 1px solid #1a1a1a;
      border-radius: 18px;
      padding: 24px;
    }
    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
    }
    .order-id {
      font-size: 12px;
      color: #666;
    }
    .order-status {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }
    .status-waiting {
      background: rgba(251, 191, 36, 0.2);
      color: #fbbf24;
    }
    .status-done {
      background: rgba(34, 197, 94, 0.2);
      color: #22c55e;
    }
    .status-declined {
      background: rgba(220, 38, 38, 0.2);
      color: #dc2626;
    }
    .order-product {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 8px;
    }
    .order-variant {
      color: #777;
      font-size: 14px;
      margin-bottom: 16px;
    }
    .order-price {
      color: #06b6d4;
      font-size: 20px;
      font-weight: 800;
      margin-bottom: 16px;
    }
    .order-license {
      background: #111;
      border: 1px solid #1a1a1a;
      border-radius: 8px;
      padding: 12px;
      margin-top: 16px;
      word-break: break-all;
      font-family: monospace;
      font-size: 14px;
    }
    .license-label {
      color: #777;
      font-size: 12px;
      margin-bottom: 8px;
    }
    .copy-btn {
      background: #111;
      color: #fff;
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 12px;
      margin-top: 8px;
    }

    /* PRODUCT DETAIL */
    .product-detail {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 40px;
      padding: 40px;
    }
    .showcase {
      position: relative;
    }
    .showcase-main {
      width: 100%;
      border-radius: 16px;
      overflow: hidden;
      margin-bottom: 16px;
    }
    .showcase-main img {
      width: 100%;
      height: 400px;
      object-fit: cover;
    }
    .showcase-thumbs {
      display: flex;
      gap: 12px;
    }
    .showcase-thumb {
      width: 80px;
      height: 80px;
      border-radius: 8px;
      overflow: hidden;
      cursor: pointer;
      border: 2px solid transparent;
      transition: .2s;
    }
    .showcase-thumb:hover,
    .showcase-thumb.active {
      border-color: #dc2626;
    }
    .showcase-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .detail-info {
      padding: 20px 0;
    }
    .breadcrumb {
      color: #666;
      font-size: 13px;
      margin-bottom: 16px;
    }
    .detail-title {
      font-size: 32px;
      font-weight: 800;
      margin-bottom: 12px;
    }
    .rating {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 20px;
    }
    .stars {
      color: #facc15;
      font-size: 18px;
    }
    .detail-price {
      font-size: 36px;
      color: #06b6d4;
      font-weight: 800;
      margin-bottom: 24px;
    }

    .variants {
      margin-bottom: 24px;
    }
    .variants h3 {
      font-size: 14px;
      margin-bottom: 12px;
      color: #aaa;
    }
    .variant-options {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .variant-option {
      background: #111;
      border: 2px solid #1a1a1a;
      border-radius: 12px;
      padding: 16px;
      cursor: pointer;
      transition: .2s;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .variant-option:hover {
      border-color: #333;
    }
    .variant-option.active {
      border-color: #06b6d4;
      background: rgba(6, 182, 212, 0.1);
    }
    .variant-option.disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .variant-label {
      display: flex;
      flex-direction: column;
    }
    .variant-name {
      font-weight: 600;
      font-size: 16px;
    }
    .variant-desc {
      font-size: 13px;
      color: #777;
    }
    .variant-price {
      font-size: 18px;
      font-weight: 700;
      color: #06b6d4;
    }
    .variant-status {
      font-size: 12px;
      color: #dc2626;
      font-weight: 600;
    }

    .quantity-selector {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 24px;
    }
    .quantity-btn {
      background: #111;
      color: #fff;
      width: 36px;
      height: 36px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }
    .quantity-input {
      background: #111;
      border: 1px solid #1a1a1a;
      color: #fff;
      width: 60px;
      height: 36px;
      text-align: center;
      border-radius: 8px;
      font-weight: 600;
    }

    .coupon-section {
      margin-bottom: 24px;
    }
    .coupon-section h3 {
      font-size: 14px;
      margin-bottom: 8px;
      color: #aaa;
    }
    .coupon-input {
      display: flex;
      gap: 8px;
    }
    .coupon-input input {
      flex: 1;
      background: #111;
      border: 1px solid #1a1a1a;
      color: #fff;
      padding: 10px 16px;
      border-radius: 8px;
      outline: none;
    }

    .add-to-cart-btn {
      width: 100%;
      background: #06b6d4;
      color: #fff;
      padding: 16px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 16px;
    }
    .add-to-cart-btn:hover {
      background: #0891b2;
    }
    .add-to-cart-btn:disabled {
      background: #333;
      cursor: not-allowed;
    }

    /* FEATURES LIST */
    .features-section {
      background: #050505;
      padding: 40px;
      border-top: 1px solid #1a1a1a;
    }
    .features-section h2 {
      font-size: 24px;
      margin-bottom: 20px;
    }
    .feature-category {
      margin-bottom: 32px;
    }
    .feature-category h3 {
      font-size: 18px;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .feature-list {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }
    .feature-item {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      font-size: 14px;
    }
    .feature-item .check {
      color: #22c55e;
      margin-top: 2px;
    }
    .feature-item strong {
      color: #fff;
    }
    .feature-item span {
      color: #999;
    }

    /* CART SIDEBAR */
    .cart-sidebar {
      position: fixed;
      top: 0;
      right: -100%;
      width: 100%;
      max-width: 450px;
      height: 100%;
      background: #0a0a0a;
      border-left: 1px solid #1a1a1a;
      z-index: 200;
      transition: .3s;
      display: flex;
      flex-direction: column;
    }
    .cart-sidebar.active {
      right: 0;
    }
    .cart-header {
      padding: 20px;
      border-bottom: 1px solid #1a1a1a;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .cart-header h2 {
      font-size: 20px;
    }
    .cart-close {
      background: #111;
      color: #fff;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
    }
    .cart-items {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
    }
    .cart-empty {
      text-align: center;
      padding: 60px 20px;
      color: #666;
    }
    .cart-item {
      background: #111;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      display: flex;
      gap: 12px;
    }
    .cart-item-img {
      width: 80px;
      height: 80px;
      border-radius: 8px;
      object-fit: cover;
    }
    .cart-item-info {
      flex: 1;
    }
    .cart-item-title {
      font-weight: 600;
      margin-bottom: 4px;
    }
    .cart-item-variant {
      font-size: 13px;
      color: #777;
      margin-bottom: 8px;
    }
    .cart-item-price {
      color: #06b6d4;
      font-weight: 700;
    }
    .cart-item-remove {
      background: #dc2626;
      color: #fff;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 12px;
      margin-top: 8px;
      display: inline-block;
    }

    .cart-footer {
      border-top: 1px solid #1a1a1a;
      padding: 20px;
    }
    .cart-total {
      display: flex;
      justify-content: space-between;
      margin-bottom: 16px;
      font-size: 18px;
      font-weight: 700;
    }
    .cart-total-price {
      color: #06b6d4;
    }
    .checkout-btn {
      width: 100%;
      background: #06b6d4;
      color: #fff;
      padding: 16px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 700;
    }

    /* CHECKOUT MODAL */
    .checkout-section {
      padding: 40px;
    }
    .checkout-section h2 {
      font-size: 28px;
      margin-bottom: 24px;
    }
    .order-summary {
      background: #111;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 24px;
    }
    .summary-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 12px;
      padding-bottom: 12px;
      border-bottom: 1px solid #1a1a1a;
    }
    .summary-item:last-child {
      border: none;
      font-size: 18px;
      font-weight: 700;
      margin-top: 8px;
    }
    .qris-section {
      text-align: center;
      margin-top: 32px;
    }
    .qris-section h3 {
      margin-bottom: 16px;
    }
    .qris-code {
      width: 300px;
      height: 300px;
      margin: 0 auto 16px;
      background: #fff;
      border-radius: 12px;
      padding: 20px;
    }
    .qris-code img {
      width: 100%;
      height: 100%;
    }
    .payment-instructions {
      background: #111;
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
      text-align: left;
    }
    .payment-instructions h4 {
      margin-bottom: 12px;
    }
    .payment-instructions ol {
      margin-left: 20px;
      color: #aaa;
    }
    .payment-instructions li {
      margin-bottom: 8px;
    }
    .upload-proof {
      margin-top: 24px;
      text-align: center;
    }
    .upload-proof h4 {
      margin-bottom: 12px;
    }
    .file-upload-wrapper {
      position: relative;
      display: inline-block;
      margin-bottom: 16px;
    }
    .file-upload-input {
      display: none;
    }
    .file-upload-btn {
      background: #111;
      border: 2px dashed #1a1a1a;
      color: #fff;
      padding: 40px 60px;
      border-radius: 12px;
      cursor: pointer;
      transition: .2s;
      display: inline-block;
    }
    .file-upload-btn:hover {
      border-color: #06b6d4;
    }
    .file-preview {
      max-width: 300px;
      margin: 16px auto;
      border-radius: 12px;
      overflow: hidden;
      display: none;
    }
    .file-preview img {
      width: 100%;
      height: auto;
    }
    .submit-payment-btn {
      background: #06b6d4;
      color: #fff;
      padding: 16px 32px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 700;
      margin-top: 16px;
    }
    .submit-payment-btn:disabled {
      background: #333;
      cursor: not-allowed;
    }

    /* ALERT */
    .alert {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #111;
      border: 1px solid #1a1a1a;
      border-radius: 12px;
      padding: 16px 20px;
      z-index: 300;
      display: none;
      min-width: 300px;
    }
    .alert.show {
      display: block;
      animation: slideIn 0.3s;
    }
    .alert-success {
      border-color: #22c55e;
    }
    .alert-error {
      border-color: #dc2626;
    }
    .alert-warning {
      border-color: #fbbf24;
    }
    @keyframes slideIn {
      from {
        transform: translateX(400px);
      }
      to {
        transform: translateX(0);
      }
    }

    /* FOOTER */
    footer {
      border-top: 1px solid #111;
      padding: 40px 0;
      margin-top: 80px;
      text-align: center;
      color: #777;
      font-size: 13px;
    }

    .hidden {
      display: none !important;
    }

    @media (max-width: 900px) {
      .features { grid-template-columns: repeat(2,1fr); }
      .products-grid { grid-template-columns: 1fr; }
      .product-detail { grid-template-columns: 1fr; }
      .feature-list { grid-template-columns: 1fr; }
      .hero h1 { font-size: 40px; }
      .search-bar { max-width: 200px; }
      .nav { gap: 12px; }
      .dashboard-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>

<header>
  <div class="container header-inner">
    <div class="logo" onclick="goToHome()">üéÆ MARGA2HIGH</div>
    <div class="nav">
      <div class="search-bar">
        <span>üîç</span>
        <input type="text" id="searchInput" placeholder="Search products...">
      </div>
      <a href="#">Terms</a>
      <a href="#">Reviews</a>
      
      <!-- Not Logged In -->
      <div id="navGuest">
        <div class="cart-icon" onclick="toggleCart()">
          üõí
          <span class="cart-badge" id="cartBadge">0</span>
        </div>
        <button class="btn btn-cyan" onclick="openAuthModal('login')">Login</button>
      </div>

      <!-- Logged In -->
      <div id="navUser" class="hidden">
        <div class="cart-icon" onclick="toggleCart()">
          üõí
          <span class="cart-badge" id="cartBadgeUser">0</span>
        </div>
        <div class="user-menu">
          <div class="user-avatar" onclick="toggleUserMenu()" id="userAvatar">U</div>
          <div class="user-dropdown" id="userDropdown">
            <div class="user-dropdown-item" onclick="goToDashboard()">
              üìä Dashboard
            </div>
            <div class="user-dropdown-item" onclick="logout()">
              üö™ Logout
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- Main Content -->
<div id="mainContent">
  <section class="hero">
    <div class="container">
      <small style="color:#dc2626;font-weight:600;">‚úî Trusted by 1200+ customers</small>
      <h1>MARGA2HIGH</h1>
      <p>Premium products, clean design, and a checkout that just works.</p>
      <button class="btn btn-red">Shop Best Sellers</button>
      <button class="btn btn-dark">Join Discord</button>
      <p style="margin-top:16px;color:#facc15;">‚≠ê 4.97 / 5 average rating</p>
    </div>
  </section>

  <section class="container features">
    <div class="feature">
      <h3>‚ö° Instant Delivery</h3>
      <p>No waiting time</p>
    </div>
    <div class="feature">
      <h3>üîí Secure Checkout</h3>
      <p>256-bit encryption</p>
    </div>
    <div class="feature">
      <h3>‚úÖ 100% Success Rate</h3>
      <p>Works as promised</p>
    </div>
    <div class="feature">
      <h3>üõ° Top-rated Support</h3>
      <p>We've got your back</p>
    </div>
  </section>

  <section class="products container">
    <h2 style="text-align:center;margin-bottom:12px;">Best Seller Products</h2>
    <p style="text-align:center;color:#777;margin-bottom:40px;">Products loved by our customers</p>

    <div class="products-grid" id="productsGrid">
      <!-- Products will be rendered here by JavaScript -->
    </div>
  </section>
</div>

<!-- Dashboard -->
<div id="dashboardContent" class="hidden">
  <section class="dashboard container">
    <div class="dashboard-header">
      <div>
        <h1 class="dashboard-title">My Orders</h1>
        <p style="color:#777;">Manage your purchases and licenses</p>
      </div>
    </div>
    <div class="dashboard-grid" id="ordersGrid">
      <!-- Orders will be rendered here -->
    </div>
  </section>
</div>

<!-- Auth Modal -->
<div class="modal" id="authModal">
  <div class="modal-close" onclick="closeAuthModal()">√ó</div>
  <div class="auth-modal-content">
    <!-- Login Form -->
    <div id="loginForm">
      <h2 class="auth-title">Welcome Back</h2>
      <p class="auth-subtitle">Login to your account</p>
      <form onsubmit="handleLogin(event)">
        <div class="form-group">
          <label class="form-label">Username</label>
          <input type="text" class="form-input" id="loginUsername" required>
        </div>
        <div class="form-group">
          <label class="form-label">Password</label>
          <input type="password" class="form-input" id="loginPassword" required>
        </div>
        <button type="submit" class="btn btn-cyan form-btn">Login</button>
      </form>
      <div class="auth-switch">
        Don't have an account? <a onclick="switchToRegister()">Register</a>
      </div>
    </div>

    <!-- Register Form -->
    <div id="registerForm" class="hidden">
      <h2 class="auth-title">Create Account</h2>
      <p class="auth-subtitle">Join MARGA2HIGH today</p>
      <form onsubmit="handleRegister(event)">
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" class="form-input" id="registerEmail" required>
        </div>
        <div class="form-group">
          <label class="form-label">Username</label>
          <input type="text" class="form-input" id="registerUsername" required>
        </div>
        <div class="form-group">
          <label class="form-label">Password</label>
          <input type="password" class="form-input" id="registerPassword" required>
        </div>
        <button type="submit" class="btn btn-cyan form-btn">Register</button>
      </form>
      <div class="auth-switch">
        Already have an account? <a onclick="switchToLogin()">Login</a>
      </div>
    </div>
  </div>
</div>

<!-- Product Detail Modal -->
<div class="modal" id="productModal">
  <div class="modal-close" onclick="closeProductModal()">√ó</div>
  <div class="modal-content">
    <div class="product-detail">
      <div class="showcase">
        <div class="showcase-main">
          <img id="showcaseMainImg" src="" alt="">
        </div>
        <div class="showcase-thumbs" id="showcaseThumbs">
          <!-- Thumbnails will be inserted here -->
        </div>
      </div>

      <div class="detail-info">
        <div class="breadcrumb">Home / Product / <span id="breadcrumbProduct"></span></div>
        <h1 class="detail-title" id="detailTitle"></h1>
        <div class="rating">
          <span class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
          <span style="color:#777;">(4.97 / 5)</span>
        </div>
        <div class="detail-price" id="detailPrice"></div>

        <div class="variants">
          <h3>Variants:</h3>
          <div class="variant-options" id="variantOptions">
            <!-- Variants will be inserted here -->
          </div>
        </div>

        <div class="quantity-selector">
          <span style="color:#aaa;font-size:14px;">Quantity:</span>
          <button class="quantity-btn" onclick="decreaseQuantity()">‚àí</button>
          <input type="number" class="quantity-input" id="quantityInput" value="1" min="1" readonly>
          <button class="quantity-btn" onclick="increaseQuantity()">+</button>
        </div>

        <div class="coupon-section">
          <h3>Coupon:</h3>
          <div class="coupon-input">
            <input type="text" placeholder="Enter Coupon Code" id="couponInput">
            <button class="btn btn-dark">Apply</button>
          </div>
        </div>

        <button class="add-to-cart-btn" onclick="addToCart()">Add to Cart</button>
        <p style="text-align:center;color:#777;font-size:13px;">üîí Secure Checkout ‚Ä¢ ‚ö° Instant Delivery</p>
      </div>
    </div>

    <!-- Features Section -->
    <div class="features-section">
      <h2>Description:</h2>
      <p style="color:#aaa;margin-bottom:32px;" id="productDescription"></p>

      <div class="feature-category">
        <h3>üî¥ Key Benefits</h3>
        <div class="feature-list" id="keyBenefits">
          <!-- Features will be inserted here -->
        </div>
      </div>

      <div class="feature-category">
        <h3>üéØ AIMBOT FEATURES</h3>
        <div class="feature-list" id="aimbotFeatures">
          <!-- Features will be inserted here -->
        </div>
      </div>

      <div class="feature-category">
        <h3>üëÅ VISUAL FEATURES (ESP)</h3>
        <div class="feature-list" id="visualFeatures">
          <!-- Features will be inserted here -->
        </div>
      </div>

      <div class="feature-category">
        <h3>üéÆ MISC</h3>
        <div class="feature-list" id="miscFeatures">
          <!-- Features will be inserted here -->
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Cart Sidebar -->
<div class="cart-sidebar" id="cartSidebar">
  <div class="cart-header">
    <h2>Shopping Cart</h2>
    <div class="cart-close" onclick="toggleCart()">√ó</div>
  </div>
  <div class="cart-items" id="cartItems">
    <div class="cart-empty">
      <p style="font-size:48px;margin-bottom:16px;">üõí</p>
      <p>Your cart is empty</p>
    </div>
  </div>
  <div class="cart-footer" id="cartFooter" style="display:none;">
    <div class="cart-total">
      <span>Total:</span>
      <span class="cart-total-price" id="cartTotal">Rp0</span>
    </div>
    <button class="checkout-btn" onclick="proceedToCheckout()">Proceed to Checkout</button>
  </div>
</div>

<!-- Checkout Modal -->
<div class="modal" id="checkoutModal">
  <div class="modal-close" onclick="closeCheckoutModal()">√ó</div>
  <div class="modal-content">
    <div class="checkout-section">
      <h2>Checkout</h2>
      
      <div class="order-summary">
        <h3 style="margin-bottom:16px;">Order Summary</h3>
        <div id="checkoutItems"></div>
        <div class="summary-item">
          <span>Subtotal:</span>
          <span id="checkoutSubtotal">Rp0</span>
        </div>
        <div class="summary-item">
          <span>Total:</span>
          <span style="color:#06b6d4;" id="checkoutTotal">Rp0</span>
        </div>
      </div>

      <div class="qris-section">
        <h3>Scan QRIS to Pay</h3>
        <div class="qris-code">
          <img src="https://api.qrserver.com/v1/create-qr-code/?size=260x260&data=00020101021226670016COM.NOBUBANK.WWW01189360050300000898740214545400010303UMI51440014ID.CO.QRIS.WWW0215ID10200984856150303UMI5204481253033605802ID5912MARGA2HIGH6007JAKARTA61051234062070703A016304" alt="QRIS Code">
        </div>
        <p style="color:#aaa;">Scan menggunakan aplikasi e-wallet atau mobile banking Anda</p>

        <div class="upload-proof">
          <h4>Upload Bukti Transfer</h4>
          <p style="color:#777;font-size:14px;margin-bottom:16px;">Upload screenshot bukti pembayaran Anda</p>
          
          <div class="file-upload-wrapper">
            <input type="file" id="paymentProof" class="file-upload-input" accept="image/*" onchange="handleFileUpload(event)">
            <label for="paymentProof" class="file-upload-btn">
              üì∑ Click to Upload<br>
              <span style="font-size:12px;color:#666;">PNG, JPG up to 5MB</span>
            </label>
          </div>

          <div class="file-preview" id="filePreview">
            <img id="previewImage" src="" alt="Preview">
          </div>

          <button class="submit-payment-btn" id="submitPaymentBtn" onclick="submitPayment()" disabled>
            Submit Payment Proof
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Alert -->
<div class="alert" id="alert">
  <div id="alertMessage"></div>
</div>

<footer>
  <div class="container">
    <strong>üéÆ MARGA2HIGH</strong><br>
    ¬© 2024 MARGA2HIGH.TOOL<br>
    <small>For educational purposes only</small>
  </div>
</footer>

<script>
  // ==================== CONFIGURATION ====================
  const DISCORD_WEBHOOK_URL = 'YOUR_DISCORD_WEBHOOK_URL_HERE'; // Ganti dengan webhook Discord Anda

  // ==================== GLOBAL STATE ====================
  let currentUser = null;
  let cart = [];
  let currentProduct = null;
  let selectedVariant = null;
  let uploadedFile = null;
  let currentOrderId = null;

  // ==================== PRODUCTS DATABASE ====================
  const products = [
    {
      id: 1,
      name: 'Valorant Internal',
      basePrice: 150000,
      images: [
        'https://images.unsplash.com/photo-1542751371-adc38448a05e?w=800',
        'https://images.unsplash.com/photo-1538481199705-c710c4e965fc?w=800',
        'https://images.unsplash.com/photo-1511512578047-dfb367046420?w=800'
      ],
      description: 'Precision, performance, and complete control. Jinx Internal delivers pro-level aimbot and ESP features while staying fully undetected, and secure. Built for legit play or full rage, optimized for maximum FPS.',
      variants: [
        { name: '1 Day Valorant Internal', duration: '1 Day', price: 150000, desc: '[1 Day License To Valorant Internal]', available: true },
        { name: '3 Days Valorant Internal', duration: '3 Days', price: 350000, desc: '[3 Days License To Valorant Internal]', available: true },
        { name: '1 Week Valorant Internal', duration: '7 Days', price: 650000, desc: '[7 Days License To Valorant Internal]', available: true },
        { name: '1 Month Valorant Internal', duration: '30 Days', price: 1800000, desc: '[31 Day License To Valorant Internal]', available: true },
        { name: 'Lifetime Valorant Internal', duration: 'Lifetime', price: 6500000, desc: '[Lifetime License To Valorant Internal]', available: false }
      ],
      features: {
        keyBenefits: [
          { icon: '‚úÖ', text: 'Undetected & Stable', desc: 'Battle-tested every update.' },
          { icon: 'üîß', text: 'Windows 10 & 11(23H2) Compatible', desc: 'Support most Windows builds.' },
          { icon: 'üîÑ', text: 'Self-Service HWID Reset', desc: 'HWID reset quickly.' },
          { icon: '‚ö°', text: 'Instant Delivery', desc: 'License key activation in seconds.' }
        ],
        aimbotFeatures: [
          { icon: '‚úÖ', text: 'Enable/Disable Aimbot', desc: 'Quick on/off toggle.' },
          { icon: 'üëÅ', text: 'Visible Check', desc: 'Only targets seen opponents.' },
          { icon: 'üéØ', text: 'Recoil Control', desc: 'Helps stabilize aim.' },
          { icon: 'ü¶¥', text: 'Aimbone Select', desc: 'Choose target bone (e.g., head/chest).' },
          { icon: 'üìê', text: 'Draw FOV', desc: 'Display the aim radius on screen.' },
          { icon: 'üéØ', text: 'Smooth', desc: 'Adjust tracking smoothness.' },
          { icon: 'üëÄ', text: 'FOV', desc: 'Set the targeting field of view.' }
        ],
        visualFeatures: [
          { icon: 'üíÄ', text: 'Skeleton', desc: 'Overlay player bone structure.' },
          { icon: 'üìè', text: 'Snapline', desc: 'Line from you to enemy.' },
          { icon: 'üì¶', text: 'Headbox', desc: 'Highlight head hitbox.' },
          { icon: '‚ù§Ô∏è', text: 'Healthbar', desc: 'Show current HP.' },
          { icon: 'üìè', text: 'Distance', desc: 'Display range to target.' },
          { icon: 'üé≠', text: 'Agent', desc: 'Show character/agent name.' },
          { icon: 'üî´', text: 'Weapon', desc: 'Show equipped weapon.' },
          { icon: 'üë•', text: 'Enemy Chams', desc: 'Colored models for visibility.' },
          { icon: 'üëÅ', text: 'Visible Check', desc: 'Only render when visible.' }
        ],
        miscFeatures: [
          { icon: 'üîì', text: 'Unlock All', desc: 'Access all skins.' },
          { icon: 'üê∞', text: 'BHOP', desc: 'Auto bunny-hop movement.' },
          { icon: 'üëÄ', text: 'FOV Changer', desc: 'Changed fov value.' },
          { icon: 'üéì', text: 'Skip Tutorial', desc: 'Skip first time tutorial.' }
        ]
      }
    },
    {
      id: 2,
      name: 'PUBG Mobile Premium',
      basePrice: 100000,
      images: [
        'https://images.unsplash.com/photo-1511512578047-dfb367046420?w=800',
        'https://images.unsplash.com/photo-1542751371-adc38448a05e?w=800'
      ],
      description: 'Dominate the battlefield with advanced ESP, aimbot, and recoil control features. Optimized for mobile gaming performance.',
      variants: [
        { name: '1 Day PUBG Mobile', duration: '1 Day', price: 100000, desc: '[1 Day License To PUBG Mobile]', available: true },
        { name: '3 Days PUBG Mobile', duration: '3 Days', price: 250000, desc: '[3 Days License To PUBG Mobile]', available: true },
        { name: '1 Week PUBG Mobile', duration: '7 Days', price: 450000, desc: '[7 Days License To PUBG Mobile]', available: true },
        { name: '1 Month PUBG Mobile', duration: '30 Days', price: 1200000, desc: '[31 Day License To PUBG Mobile]', available: true }
      ],
      features: {
        keyBenefits: [
          { icon: '‚úÖ', text: 'Undetected', desc: 'Safe from anti-cheat.' },
          { icon: 'üì±', text: 'Android Compatible', desc: 'Works on most devices.' },
          { icon: '‚ö°', text: 'Fast Updates', desc: 'Quick patch support.' },
          { icon: 'üîÑ', text: 'Easy Installation', desc: 'Simple setup process.' }
        ],
        aimbotFeatures: [
          { icon: 'üéØ', text: 'Auto Aim', desc: 'Automatic targeting.' },
          { icon: 'üí•', text: 'No Recoil', desc: 'Zero weapon recoil.' },
          { icon: 'üî´', text: 'Rapid Fire', desc: 'Increased fire rate.' },
          { icon: 'üëÅ', text: 'Lock Target', desc: 'Stay on target.' }
        ],
        visualFeatures: [
          { icon: 'üì¶', text: 'Box ESP', desc: 'Box around players.' },
          { icon: '‚ù§Ô∏è', text: 'Health ESP', desc: 'Show enemy health.' },
          { icon: 'üìè', text: 'Distance ESP', desc: 'Display distance.' },
          { icon: 'üéí', text: 'Item ESP', desc: 'See items through walls.' },
          { icon: 'üöó', text: 'Vehicle ESP', desc: 'Locate vehicles.' }
        ],
        miscFeatures: [
          { icon: 'üèÉ', text: 'Speed Hack', desc: 'Move faster.' },
          { icon: 'ü¶ò', text: 'Jump Hack', desc: 'Higher jumps.' },
          { icon: 'üåà', text: 'Skin Changer', desc: 'Change weapon skins.' }
        ]
      }
    },
    {
      id: 3,
      name: 'CS2 External',
      basePrice: 200000,
      images: [
        'https://images.unsplash.com/photo-1552820728-8b83bb6b773f?w=800',
        'https://images.unsplash.com/photo-1538481199705-c710c4e965fc?w=800'
      ],
      description: 'Professional-grade external cheat for CS2. Features advanced triggerbot, ESP, and radar hack with smooth performance.',
      variants: [
        { name: '1 Day CS2 External', duration: '1 Day', price: 200000, desc: '[1 Day License To CS2 External]', available: true },
        { name: '3 Days CS2 External', duration: '3 Days', price: 450000, desc: '[3 Days License To CS2 External]', available: true },
        { name: '1 Week CS2 External', duration: '7 Days', price: 800000, desc: '[7 Days License To CS2 External]', available: true },
        { name: '1 Month CS2 External', duration: '30 Days', price: 2200000, desc: '[31 Day License To CS2 External]', available: true }
      ],
      features: {
        keyBenefits: [
          { icon: '‚úÖ', text: 'External & Safe', desc: 'Lower detection risk.' },
          { icon: 'üîß', text: 'Windows 10 & 11', desc: 'Full compatibility.' },
          { icon: '‚ö°', text: 'Low CPU Usage', desc: 'Minimal performance impact.' },
          { icon: 'üîÑ', text: 'Auto Updates', desc: 'Always current.' }
        ],
        aimbotFeatures: [
          { icon: 'üéØ', text: 'Triggerbot', desc: 'Auto-fire when on target.' },
          { icon: 'üéØ', text: 'Smooth Aim', desc: 'Natural-looking aim.' },
          { icon: 'üí•', text: 'Recoil Compensation', desc: 'Control spray pattern.' },
          { icon: 'üëÅ', text: 'Visibility Check', desc: 'Only visible targets.' }
        ],
        visualFeatures: [
          { icon: 'üì¶', text: 'Player ESP', desc: 'See all players.' },
          { icon: 'üíÄ', text: 'Skeleton ESP', desc: 'Bone overlay.' },
          { icon: '‚ù§Ô∏è', text: 'Health Bar', desc: 'HP display.' },
          { icon: 'üî´', text: 'Weapon ESP', desc: 'Show weapons.' },
          { icon: 'üí£', text: 'Bomb ESP', desc: 'Locate C4.' },
          { icon: 'üó∫', text: 'Radar Hack', desc: 'Full map awareness.' }
        ],
        miscFeatures: [
          { icon: 'üåà', text: 'Skin Changer', desc: 'Custom skins.' },
          { icon: 'üé®', text: 'Chams', desc: 'Colored players.' },
          { icon: 'üîä', text: 'Sound ESP', desc: 'Audio indicators.' }
        ]
      }
    }
  ];

  // ==================== INITIALIZATION ====================
  document.addEventListener('DOMContentLoaded', () => {
    checkAuth();
    renderProducts();
  });

  // ==================== AUTH FUNCTIONS ====================
  function checkAuth() {
    const user = localStorage.getItem('currentUser');
    if (user) {
      currentUser = JSON.parse(user);
      updateUIForLoggedIn();
    }
  }

  function updateUIForLoggedIn() {
    document.getElementById('navGuest').classList.add('hidden');
    document.getElementById('navUser').classList.remove('hidden');
    document.getElementById('userAvatar').textContent = currentUser.username.charAt(0).toUpperCase();
    updateCartUI();
  }

  function updateUIForGuest() {
    document.getElementById('navGuest').classList.remove('hidden');
    document.getElementById('navUser').classList.add('hidden');
    updateCartUI();
  }

  function openAuthModal(type) {
    if (type === 'login') {
      document.getElementById('loginForm').classList.remove('hidden');
      document.getElementById('registerForm').classList.add('hidden');
    } else {
      document.getElementById('loginForm').classList.add('hidden');
      document.getElementById('registerForm').classList.remove('hidden');
    }
    document.getElementById('authModal').classList.add('active');
    document.body.style.overflow = 'hidden';
  }

  function closeAuthModal() {
    document.getElementById('authModal').classList.remove('active');
    document.body.style.overflow = '';
  }

  function switchToLogin() {
    document.getElementById('loginForm').classList.remove('hidden');
    document.getElementById('registerForm').classList.add('hidden');
  }

  function switchToRegister() {
    document.getElementById('loginForm').classList.add('hidden');
    document.getElementById('registerForm').classList.remove('hidden');
  }

  function handleRegister(e) {
    e.preventDefault();
    const email = document.getElementById('registerEmail').value;
    const username = document.getElementById('registerUsername').value;
    const password = document.getElementById('registerPassword').value;

    // Get existing users
    let users = JSON.parse(localStorage.getItem('users') || '[]');
    
    // Check if username exists
    if (users.find(u => u.username === username)) {
      showAlert('Username already exists', 'error');
      return;
    }

    // Create new user
    const newUser = {
      id: Date.now(),
      email,
      username,
      password,
      createdAt: new Date().toISOString()
    };

    users.push(newUser);
    localStorage.setItem('users', JSON.stringify(users));

    showAlert('Registration successful! Please login.', 'success');
    switchToLogin();
  }

  function handleLogin(e) {
    e.preventDefault();
    const username = document.getElementById('loginUsername').value;
    const password = document.getElementById('loginPassword').value;

    const users = JSON.parse(localStorage.getItem('users') || '[]');
    const user = users.find(u => u.username === username && u.password === password);

    if (user) {
      currentUser = user;
      localStorage.setItem('currentUser', JSON.stringify(user));
      updateUIForLoggedIn();
      closeAuthModal();
      showAlert('Login successful!', 'success');
    } else {
      showAlert('Invalid username or password', 'error');
    }
  }

  function logout() {
    currentUser = null;
    localStorage.removeItem('currentUser');
    updateUIForGuest();
    goToHome();
    showAlert('Logged out successfully', 'success');
  }

  function toggleUserMenu() {
    document.getElementById('userDropdown').classList.toggle('active');
  }

  // Close dropdown when clicking outside
  document.addEventListener('click', (e) => {
    if (!e.target.closest('.user-menu')) {
      document.getElementById('userDropdown').classList.remove('active');
    }
  });

  // ==================== NAVIGATION ====================
  function goToHome() {
    document.getElementById('mainContent').classList.remove('hidden');
    document.getElementById('dashboardContent').classList.add('hidden');
    window.scrollTo(0, 0);
  }

  function goToDashboard() {
    if (!currentUser) {
      openAuthModal('login');
      return;
    }
    document.getElementById('mainContent').classList.add('hidden');
    document.getElementById('dashboardContent').classList.remove('hidden');
    renderOrders();
    window.scrollTo(0, 0);
  }

  // ==================== PRODUCTS ====================
  function renderProducts(searchQuery = '') {
    const grid = document.getElementById('productsGrid');
    const filtered = products.filter(p => 
      p.name.toLowerCase().includes(searchQuery.toLowerCase())
    );

    grid.innerHTML = filtered.map(product => `
      <div class="product" onclick="openProductModal(${product.id})">
        <img src="${product.images[0]}" alt="${product.name}">
        <div class="product-body">
          <h4>${product.name}</h4>
          <div class="price">Rp${product.basePrice.toLocaleString('id-ID')}</div>
        </div>
      </div>
    `).join('');

    if (filtered.length === 0) {
      grid.innerHTML = '<p style="text-align:center;color:#666;grid-column:1/-1;">No products found</p>';
    }
  }

  document.getElementById('searchInput').addEventListener('input', (e) => {
    renderProducts(e.target.value);
  });

  function openProductModal(productId) {
    currentProduct = products.find(p => p.id === productId);
    if (!currentProduct) return;

    selectedVariant = currentProduct.variants[0];

    document.getElementById('showcaseMainImg').src = currentProduct.images[0];
    document.getElementById('breadcrumbProduct').textContent = currentProduct.name;
    document.getElementById('detailTitle').textContent = currentProduct.name;
    document.getElementById('detailPrice').textContent = `Rp${currentProduct.basePrice.toLocaleString('id-ID')}`;
    document.getElementById('productDescription').textContent = currentProduct.description;

    const thumbsContainer = document.getElementById('showcaseThumbs');
    thumbsContainer.innerHTML = currentProduct.images.map((img, idx) => `
      <div class="showcase-thumb ${idx === 0 ? 'active' : ''}" onclick="changeShowcaseImage(${idx})">
        <img src="${img}" alt="">
      </div>
    `).join('');

    const variantsContainer = document.getElementById('variantOptions');
    variantsContainer.innerHTML = currentProduct.variants.map((variant, idx) => `
      <div class="variant-option ${idx === 0 ? 'active' : ''} ${!variant.available ? 'disabled' : ''}" 
           onclick="selectVariant(${idx})">
        <div class="variant-label">
          <div class="variant-name">${variant.name}</div>
          <div class="variant-desc">${variant.desc}</div>
        </div>
        <div>
          <div class="variant-price">Rp${variant.price.toLocaleString('id-ID')}</div>
          ${!variant.available ? '<div class="variant-status">not now</div>' : ''}
        </div>
      </div>
    `).join('');

    renderFeatures('keyBenefits', currentProduct.features.keyBenefits);
    renderFeatures('aimbotFeatures', currentProduct.features.aimbotFeatures);
    renderFeatures('visualFeatures', currentProduct.features.visualFeatures);
    renderFeatures('miscFeatures', currentProduct.features.miscFeatures);

    document.getElementById('quantityInput').value = 1;
    document.getElementById('productModal').classList.add('active');
    document.body.style.overflow = 'hidden';
  }

  function closeProductModal() {
    document.getElementById('productModal').classList.remove('active');
    document.body.style.overflow = '';
  }

  function changeShowcaseImage(index) {
    document.getElementById('showcaseMainImg').src = currentProduct.images[index];
    document.querySelectorAll('.showcase-thumb').forEach((thumb, idx) => {
      thumb.classList.toggle('active', idx === index);
    });
  }

  function selectVariant(index) {
    const variant = currentProduct.variants[index];
    if (!variant.available) return;

    selectedVariant = variant;
    document.getElementById('detailPrice').textContent = `Rp${variant.price.toLocaleString('id-ID')}`;

    document.querySelectorAll('.variant-option').forEach((opt, idx) => {
      opt.classList.toggle('active', idx === index);
    });
  }

  function renderFeatures(containerId, features) {
    const container = document.getElementById(containerId);
    container.innerHTML = features.map(feature => `
      <div class="feature-item">
        <span class="check">${feature.icon}</span>
        <div>
          <strong>${feature.text}</strong>
          <span> ‚Äî ${feature.desc}</span>
        </div>
      </div>
    `).join('');
  }

  function decreaseQuantity() {
    const input = document.getElementById('quantityInput');
    if (input.value > 1) {
      input.value = parseInt(input.value) - 1;
    }
  }

  function increaseQuantity() {
    const input = document.getElementById('quantityInput');
    input.value = parseInt(input.value) + 1;
  }

  // ==================== CART ====================
  function addToCart() {
    if (!selectedVariant || !selectedVariant.available) {
      showAlert('Please select an available variant', 'warning');
      return;
    }

    const quantity = parseInt(document.getElementById('quantityInput').value);
    
    const cartItem = {
      productId: currentProduct.id,
      productName: currentProduct.name,
      variantName: selectedVariant.name,
      price: selectedVariant.price,
      quantity: quantity,
      image: currentProduct.images[0]
    };

    const existingIndex = cart.findIndex(item => 
      item.productId === cartItem.productId && item.variantName === cartItem.variantName
    );

    if (existingIndex > -1) {
      cart[existingIndex].quantity += quantity;
    } else {
      cart.push(cartItem);
    }

    updateCartUI();
    closeProductModal();
    toggleCart();
    showAlert('Added to cart!', 'success');
  }

  function toggleCart() {
    const sidebar = document.getElementById('cartSidebar');
    sidebar.classList.toggle('active');
    if (sidebar.classList.contains('active')) {
      document.body.style.overflow = 'hidden';
    } else {
      document.body.style.overflow = '';
    }
  }

  function updateCartUI() {
    const badge = document.getElementById('cartBadge');
    const badgeUser = document.getElementById('cartBadgeUser');
    const itemsContainer = document.getElementById('cartItems');
    const footer = document.getElementById('cartFooter');

    const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
    badge.textContent = totalItems;
    badgeUser.textContent = totalItems;

    if (cart.length === 0) {
      itemsContainer.innerHTML = `
        <div class="cart-empty">
          <p style="font-size:48px;margin-bottom:16px;">üõí</p>
          <p>Your cart is empty</p>
        </div>
      `;
      footer.style.display = 'none';
    } else {
      itemsContainer.innerHTML = cart.map((item, idx) => `
        <div class="cart-item">
          <img src="${item.image}" alt="${item.productName}" class="cart-item-img">
          <div class="cart-item-info">
            <div class="cart-item-title">${item.productName}</div>
            <div class="cart-item-variant">${item.variantName}</div>
            <div class="cart-item-price">Rp${item.price.toLocaleString('id-ID')} x ${item.quantity}</div>
            <button class="cart-item-remove" onclick="removeFromCart(${idx})">Remove</button>
          </div>
        </div>
      `).join('');

      const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      document.getElementById('cartTotal').textContent = `Rp${total.toLocaleString('id-ID')}`;
      footer.style.display = 'block';
    }
  }

  function removeFromCart(index) {
    cart.splice(index, 1);
    updateCartUI();
  }

  // ==================== CHECKOUT ====================
  function proceedToCheckout() {
    if (!currentUser) {
      toggleCart();
      showAlert('Please login to checkout', 'warning');
      openAuthModal('login');
      return;
    }

    if (cart.length === 0) return;

    const checkoutItems = document.getElementById('checkoutItems');
    checkoutItems.innerHTML = cart.map(item => `
      <div class="summary-item">
        <span>${item.productName} - ${item.variantName} (x${item.quantity})</span>
        <span>Rp${(item.price * item.quantity).toLocaleString('id-ID')}</span>
      </div>
    `).join('');

    const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
    document.getElementById('checkoutSubtotal').textContent = `Rp${total.toLocaleString('id-ID')}`;
    document.getElementById('checkoutTotal').textContent = `Rp${total.toLocaleString('id-ID')}`;

    // Reset payment proof
    uploadedFile = null;
    document.getElementById('paymentProof').value = '';
    document.getElementById('filePreview').style.display = 'none';
    document.getElementById('submitPaymentBtn').disabled = true;

    toggleCart();
    document.getElementById('checkoutModal').classList.add('active');
    document.body.style.overflow = 'hidden';
  }

  function closeCheckoutModal() {
    document.getElementById('checkoutModal').classList.remove('active');
    document.body.style.overflow = '';
  }

  function handleFileUpload(event) {
    const file = event.target.files[0];
    if (!file) return;

    if (file.size > 5 * 1024 * 1024) {
      showAlert('File size must be less than 5MB', 'error');
      return;
    }

    uploadedFile = file;
    
    const reader = new FileReader();
    reader.onload = (e) => {
      document.getElementById('previewImage').src = e.target.result;
      document.getElementById('filePreview').style.display = 'block';
      document.getElementById('submitPaymentBtn').disabled = false;
    };
    reader.readAsDataURL(file);
  }

  async function submitPayment() {
    if (!uploadedFile) {
      showAlert('Please upload payment proof', 'warning');
      return;
    }

    const submitBtn = document.getElementById('submitPaymentBtn');
    submitBtn.disabled = true;
    submitBtn.textContent = 'Submitting...';

    try {
      // Create order
      const orderId = 'ORD-' + Date.now();
      currentOrderId = orderId;
      const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

      const order = {
        id: orderId,
        userId: currentUser.id,
        username: currentUser.username,
        email: currentUser.email,
        items: [...cart],
        total: total,
        status: 'waiting',
        createdAt: new Date().toISOString(),
        license: null
      };

      // Save order
      let orders = JSON.parse(localStorage.getItem('orders') || '[]');
      orders.push(order);
      localStorage.setItem('orders', JSON.stringify(orders));

      // Convert image to base64
      const reader = new FileReader();
      reader.onload = async () => {
        const base64Image = reader.result;

        // Send to Discord webhook
        await sendToDiscord(order, base64Image);

        // Clear cart
        cart = [];
        updateCartUI();
        closeCheckoutModal();
        
        showAlert('Payment proof submitted! Waiting for approval...', 'success');
        goToDashboard();
      };
      reader.readAsDataURL(uploadedFile);

    } catch (error) {
      console.error('Error submitting payment:', error);
      showAlert('Failed to submit payment. Please try again.', 'error');
      submitBtn.disabled = false;
      submitBtn.textContent = 'Submit Payment Proof';
    }
  }

  async function sendToDiscord(order, imageBase64) {
    const itemsList = order.items.map(item => 
      `${item.productName} - ${item.variantName} (x${item.quantity}) - Rp${(item.price * item.quantity).toLocaleString('id-ID')}`
    ).join('\n');

    const embed = {
      title: 'üí≥ New Payment Submission',
      color: 0x06b6d4,
      fields: [
        {
          name: 'üìã Order ID',
          value: order.id,
          inline: true
        },
        {
          name: 'üë§ Customer',
          value: order.username,
          inline: true
        },
        {
          name: 'üìß Email',
          value: order.email,
          inline: true
        },
        {
          name: 'üõí Items',
          value: itemsList
        },
        {
          name: 'üí∞ Total',
          value: `Rp${order.total.toLocaleString('id-ID')}`,
          inline: true
        },
        {
          name: 'üìÖ Date',
          value: new Date(order.createdAt).toLocaleString('id-ID'),
          inline: true
        }
      ],
      image: {
        url: 'attachment://payment_proof.png'
      },
      footer: {
        text: 'React with üëç to approve or üëé to decline'
      },
      timestamp: new Date().toISOString()
    };

    // Convert base64 to blob
    const blob = await fetch(imageBase64).then(r => r.blob());
    
    const formData = new FormData();
    formData.append('payload_json', JSON.stringify({
      embeds: [embed],
      content: `@here New payment submission from **${order.username}**\n\nOrder ID: \`${order.id}\``
    }));
    formData.append('file', blob, 'payment_proof.png');

    // Send to webhook
    if (DISCORD_WEBHOOK_URL && DISCORD_WEBHOOK_URL !== 'YOUR_DISCORD_WEBHOOK_URL_HERE') {
      try {
        await fetch(DISCORD_WEBHOOK_URL, {
          method: 'POST',
          body: formData
        });
      } catch (error) {
        console.error('Discord webhook error:', error);
      }
    } else {
      console.log('Discord webhook not configured. Order saved locally.');
      console.log('Order details:', order);
    }
  }

  // ==================== ORDERS/DASHBOARD ====================
  function renderOrders() {
    if (!currentUser) return;

    const orders = JSON.parse(localStorage.getItem('orders') || '[]');
    const userOrders = orders.filter(o => o.userId === currentUser.id);
    const grid = document.getElementById('ordersGrid');

    if (userOrders.length === 0) {
      grid.innerHTML = `
        <div style="grid-column:1/-1;text-align:center;padding:60px 20px;">
          <p style="font-size:48px;margin-bottom:16px;">üì¶</p>
          <p style="color:#666;">No orders yet</p>
          <button class="btn btn-cyan" style="margin-top:24px;" onclick="goToHome()">Start Shopping</button>
        </div>
      `;
      return;
    }

    grid.innerHTML = userOrders.reverse().map(order => `
      <div class="order-card">
        <div class="order-header">
          <div>
            <div class="order-id">Order #${order.id}</div>
            <div class="order-product">${order.items[0].productName}</div>
            <div class="order-variant">${order.items[0].variantName}</div>
          </div>
          <div class="order-status status-${order.status}">
            ${order.status === 'waiting' ? '‚è≥ Waiting' : order.status === 'done' ? '‚úÖ Done' : '‚ùå Declined'}
          </div>
        </div>
        
        <div class="order-price">Rp${order.total.toLocaleString('id-ID')}</div>
        
        ${order.items.length > 1 ? `<p style="color:#777;font-size:14px;">+${order.items.length - 1} more items</p>` : ''}
        
        ${order.status === 'done' && order.license ? `
          <div class="order-license">
            <div class="license-label">License Key:</div>
            <div style="color:#06b6d4;word-break:break-all;">${order.license}</div>
            <button class="copy-btn" onclick="copyLicense('${order.license}')">üìã Copy License</button>
          </div>
        ` : ''}
        
        ${order.status === 'waiting' ? `
          <p style="color:#fbbf24;font-size:13px;margin-top:12px;">‚è≥ Waiting for owner approval...</p>
        ` : ''}
        
        ${order.status === 'declined' ? `
          <p style="color:#dc2626;font-size:13px;margin-top:12px;">‚ùå Payment declined. Please contact support.</p>
        ` : ''}
        
        <p style="color:#666;font-size:12px;margin-top:12px;">${new Date(order.createdAt).toLocaleString('id-ID')}</p>
      </div>
    `).join('');
  }

  function copyLicense(license) {
    navigator.clipboard.writeText(license);
    showAlert('License copied to clipboard!', 'success');
  }

  // ==================== DISCORD WEBHOOK SIMULATION ====================
  // In production, you'll handle approval through Discord bot
  // This is a simulation function for testing
  window.approveOrder = function(orderId, license) {
    let orders = JSON.parse(localStorage.getItem('orders') || '[]');
    const orderIndex = orders.findIndex(o => o.id === orderId);
    
    if (orderIndex > -1) {
      orders[orderIndex].status = 'done';
      orders[orderIndex].license = license;
      localStorage.setItem('orders', JSON.stringify(orders));
      
      if (currentUser && currentUser.id === orders[orderIndex].userId) {
        renderOrders();
      }
    }
  };

  window.declineOrder = function(orderId) {
    let orders = JSON.parse(localStorage.getItem('orders') || '[]');
    const orderIndex = orders.findIndex(o => o.id === orderId);
    
    if (orderIndex > -1) {
      orders[orderIndex].status = 'declined';
      localStorage.setItem('orders', JSON.stringify(orders));
      
      if (currentUser && currentUser.id === orders[orderIndex].userId) {
        renderOrders();
      }
    }
  };

  // ==================== ALERTS ====================
  function showAlert(message, type = 'success') {
    const alert = document.getElementById('alert');
    const alertMessage = document.getElementById('alertMessage');
    
    alert.className = `alert alert-${type} show`;
    alertMessage.textContent = message;
    
    setTimeout(() => {
      alert.classList.remove('show');
    }, 4000);
  }

  // ==================== UTILITIES ====================
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      closeProductModal();
      closeCheckoutModal();
      closeAuthModal();
      if (document.getElementById('cartSidebar').classList.contains('active')) {
        toggleCart();
      }
    }
  });
</script>

</body>
</html>
